---
title: "Measuring Political Freedom Around the World"
subtitle: "Sabrina Ball, Joe Despres, Joe Sigler, Jacob Haywood"
date: "Last compiled `r format(Sys.time(), '%H:%M')`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
source(here::here("R", "regression.R"))
theme_set(theme_light(base_size = 30))
options(htmltools.dir.version = FALSE, echo = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.width=12, fig.height=8) 
```

# Research Question

* This study will focus on political freedom around the world. 

--

* We ask: What factors are associated with an increase in political freedom?.

--

* Observational study of political freedom as a function of social, economic, political factors.

--

* From Data provided by the Gapminder Foundation.

--

* filtered to only include OECD Countries from year 2000 to 2018 by necessity

---
class: inverse, middle, center

# Data

---

# Political Freedom

- Freedomhouse quantifies Political Rights by 10 different indicators grouped in three subcategories.

--

1. Electoral Process

--

1. Political Participation and Pluralism

--

1. Discretionary Political rights. 

---


# Covariates  

- Country  

--

- Year from 2000 to 2018  

--

- Corruption Perception Index Ranging from 0 to 100 with 0 being the most corruption perception.  

--

- Education Expenditure in GDP per Person

--

- Electricity use per person in Kilowatt Hours.

--

- Gini Coefficient. A measure of a nation's wealth inequality ranging from 0 being perfectly equal distribution of income and 1 being one person has all nation's wealth. 

--

- Percentage of population That use the Internet.

--

- Labor Force Participation.

--

- Life Expectancy

--

- Military Spending as a percentage of GDP

--

- Murders per million people. 

---

```{r message=FALSE}
data %>% 
  group_by(country) %>% 
summarise(across(.cols = c(corruption_perception_index_cpi:murder_per_mil_people), mean)) %>% 
  mutate_if(is.numeric, round, 2) %>% 
  kable(
    col.names = c("Country", "CPI", "Edu Exp", "Electric Use", "Gini", "Internet Users", "Labor Force", "Life Expectancy","Military Spending", "Murder Rate")) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), font_size = 6, fixed_thead = T)
```

---
class: center, middle
```{r}
data %>% 
  group_by(polrights_fh) %>% 
  add_count(polrights_fh) %>% 
  ggplot() + 
  geom_bar(aes(x = polrights_fh, fill = factor(polrights_fh)), color = "black") + 
  
  geom_text(aes(x = polrights_fh, y = n, label = n), vjust = -.75) + 
  viridis::scale_fill_viridis(discrete = TRUE, direction = -1) +
  scale_x_continuous(breaks = 1:7) + 
  theme_test(base_size = 30) + 
  theme(legend.position="none")
```


---

# Assumptions

--
* Finite mean and sd
* independance
* Linearity
* Normaily
* Homoskidasticity

---

# Best Subsets by Adjusted R Squared
```{r message=FALSE}
subsets %>% 
  group_by(df) %>% 
  filter(adj.r.squared == max(adj.r.squared)) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  rename(a_rsq = adj.r.squared) %>% 
  select(df, a_rsq, model) %>% 
  arrange(desc(a_rsq)) %>% 
DT::datatable(fillContainer = FALSE, options = list(pageLength = 3), 
              colnames = c("DF", "A_Rsq", "Model"))
```

---
# Best Subsets by AIC
```{r message=FALSE}
subsets %>% 
  group_by(df) %>% 
  filter(AIC == min(AIC)) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  select(df, AIC, model) %>% 
  arrange(AIC) %>% 
DT::datatable(fillContainer = FALSE, options = list(pageLength = 3),
              colnames = c("DF", "AIC", "Model"))
```

---

# Best Subsets by BIC
```{r message=FALSE}
subsets %>% 
  group_by(df) %>% 
  filter(BIC == min(BIC)) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  select(df, BIC, model) %>% 
  arrange(BIC) %>% 
DT::datatable(fillContainer = FALSE, options = list(pageLength = 3),
              colnames = c("DF", "BIC", "Model"))
```

---

class: center, middle

# Best Subsets

```{r, message=FALSE, warning=FALSE, fig.width=12, fig.height=8}
r <- subsets %>% group_by(df) %>% summarise(adj = max(adj.r.squared, na.rm = T))

subsets %>% 
  ggplot(aes(x = df, y = adj.r.squared)) + 
  geom_point() + 
  geom_smooth(data = r, aes(df, adj), se = FALSE, span = 0.5, color = "Green") + 
  labs(title = "", x = "Parameters", y = "Adjusted R Squared") + 
  scale_x_continuous(breaks = 1:9) + 
  theme_test(base_size = 30)
```

---
class: center, middle

# Best Subsets

```{r, message=FALSE, warning=FALSE, fig.width=12, fig.height=8}
r <- subsets %>% group_by(df) %>% summarise(AIC = max(AIC, na.rm = T))

subsets %>% 
  ggplot(aes(x = df, y = AIC)) + 
  geom_point() + 
  geom_smooth(data = r, aes(df, AIC), se = FALSE, span = 0.5, color = "red") + 
  labs(title = "", x = "Parameters", y = "AIC") + 
  scale_x_continuous(breaks = 1:9) + 
  theme_test(base_size = 30)
```

---

class: inverse, middle, center

# Model

---

class: center, middle

```{r include=FALSE}
equatiomatic::extract_eq(model = model_df5, intercept = "beta", terms_per_line = 1)
```

$$
\large
\begin{align}
\operatorname{polrights} = \beta_{0} + \beta_{1}(\operatorname{corruption\_perception\_index\_cpi}) +\\ \beta_{2}(\operatorname{edu\_exp\_gdp\_per\_person}) +\\ \beta_{3}(\operatorname{life\_expectancy\_years}) +\\ \beta_{4}(\operatorname{military\_spending\_pct\_of\_gdp}) +\\ \beta_{5}(\operatorname{murder\_per\_mil\_people}) + \epsilon
\end{align}
$$
---
class: center

$$
\small
\begin{align}
\operatorname{polrights} = \beta_{0} + \beta_{1}(\operatorname{corruption\_perception\_index\_cpi}) +\\ \beta_{2}(\operatorname{edu\_exp\_gdp\_per\_person}) +\\ \beta_{3}(\operatorname{life\_expectancy\_years}) +\\ \beta_{4}(\operatorname{military\_spending\_pct\_of\_gdp}) +\\ \beta_{5}(\operatorname{murder\_per\_mil\_people}) + \epsilon
\end{align}
$$

```{r}
broom::tidy(model_df5) %>% 
  mutate(p.value = as.character(p.value)) %>%
  mutate_if(is.numeric, round, 3) %>% 
  mutate(p.value = as.numeric(p.value)) %>% 
  kable(col.names = c("Term", "Estimate", "Std. Error", "T-Stat", "P-Value")) 
```

***
```{r}
broom::glance(model_df5) %>% 
  select(r.squared, adj.r.squared, adj.r.squared, AIC, BIC) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  kable()
```

---
class: center
$$
\small
\begin{align}
\operatorname{polrights} = \beta_{0} + \beta_{1}(\operatorname{corruption\_perception\_index\_cpi}) +\\ \beta_{2}(\operatorname{edu\_exp\_gdp\_per\_person}) +\\ \beta_{3}(\operatorname{life\_expectancy\_years}) +\\ \beta_{4}(\operatorname{military\_spending\_pct\_of\_gdp}) +\\ \beta_{5}(\operatorname{murder\_per\_mil\_people}) + \epsilon
\end{align}
$$
```{r}
broom::tidy(model_df5) %>% 
  mutate(p.value = as.character(p.value)) %>%
  mutate_if(is.numeric, round, 3) %>% 
  mutate(p.value = as.numeric(p.value)) %>% 
  kable(col.names =  c("Term", "Estimate", "Std. Error", "T-Stat", "P-Value"))  %>% 
  row_spec(2, color = "white", background = "#D7261E")
```

***

```{r}
broom::glance(model_df5) %>% 
  select(r.squared, adj.r.squared, adj.r.squared, AIC, BIC) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  kable()
```


---
class: center
$$
\small
\begin{align}
\operatorname{polrights} = \beta_{0} + \beta_{1}(\operatorname{corruption\_perception\_index\_cpi}) +\\ \beta_{2}(\operatorname{edu\_exp\_gdp\_per\_person}) +\\ \beta_{3}(\operatorname{life\_expectancy\_years}) +\\ \beta_{4}(\operatorname{military\_spending\_pct\_of\_gdp}) +\\ \beta_{5}(\operatorname{murder\_per\_mil\_people}) + \epsilon
\end{align}
$$
```{r}
broom::tidy(model_df5) %>% 
  mutate(p.value = as.character(p.value)) %>%
  mutate_if(is.numeric, round, 3) %>% 
  mutate(p.value = as.numeric(p.value)) %>% 
  kable(col.names =  c("Term", "Estimate", "Std. Error", "T-Stat", "P-Value")) %>% 
  row_spec(3, color = "white", background = "#D7261E")
```

***

```{r}
broom::glance(model_df5) %>% 
  select(r.squared, adj.r.squared, adj.r.squared, AIC, BIC) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  kable()
```


---
class: center
$$
\small
\begin{align}
\operatorname{polrights} = \beta_{0} + \beta_{1}(\operatorname{corruption\_perception\_index\_cpi}) +\\ \beta_{2}(\operatorname{edu\_exp\_gdp\_per\_person}) +\\ \beta_{3}(\operatorname{life\_expectancy\_years}) +\\ \beta_{4}(\operatorname{military\_spending\_pct\_of\_gdp}) +\\ \beta_{5}(\operatorname{murder\_per\_mil\_people}) + \epsilon
\end{align}
$$
```{r}
broom::tidy(model_df5) %>% 
  mutate(p.value = as.character(p.value)) %>%
  mutate_if(is.numeric, round, 3) %>% 
  mutate(p.value = as.numeric(p.value)) %>% 
  kable(col.names =  c("Term", "Estimate", "Std. Error", "T-Stat", "P-Value")) %>% 
  row_spec(4, color = "white", background = "#D7261E")
```

***

```{r}
broom::glance(model_df5) %>% 
  select(r.squared, adj.r.squared, adj.r.squared, AIC, BIC) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  kable()
```


---

class: center
$$
\small
\begin{align}
\operatorname{polrights} = \beta_{0} + \beta_{1}(\operatorname{corruption\_perception\_index\_cpi}) +\\ \beta_{2}(\operatorname{edu\_exp\_gdp\_per\_person}) +\\ \beta_{3}(\operatorname{life\_expectancy\_years}) +\\ \beta_{4}(\operatorname{military\_spending\_pct\_of\_gdp}) +\\ \beta_{5}(\operatorname{murder\_per\_mil\_people}) + \epsilon
\end{align}
$$
```{r}
broom::tidy(model_df5) %>% 
  mutate(p.value = as.character(p.value)) %>%
  mutate_if(is.numeric, round, 3) %>% 
  mutate(p.value = as.numeric(p.value)) %>% 
  kable(col.names =  c("Term", "Estimate", "Std. Error", "T-Stat", "P-Value")) %>% 
  row_spec(5, color = "white", background = "#D7261E")
```

***

```{r}
broom::glance(model_df5) %>% 
  select(r.squared, adj.r.squared, adj.r.squared, AIC, BIC) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  kable()
```

---
class: center
$$
\small
\begin{align}
\operatorname{polrights} = \beta_{0} + \beta_{1}(\operatorname{corruption\_perception\_index\_cpi}) +\\ \beta_{2}(\operatorname{edu\_exp\_gdp\_per\_person}) +\\ \beta_{3}(\operatorname{life\_expectancy\_years}) +\\ \beta_{4}(\operatorname{military\_spending\_pct\_of\_gdp}) +\\ \beta_{5}(\operatorname{murder\_per\_mil\_people}) + \epsilon
\end{align}
$$
```{r}
broom::tidy(model_df5) %>% 
  mutate(p.value = as.character(p.value)) %>%
  mutate_if(is.numeric, round, 3) %>% 
  mutate(p.value = as.numeric(p.value)) %>% 
  kable(col.names =  c("Term", "Estimate", "Std. Error", "T-Stat", "P-Value")) %>% 
  row_spec(6, color = "white", background = "#D7261E")
```

***

```{r}
broom::glance(model_df5) %>% 
  select(r.squared, adj.r.squared, adj.r.squared, AIC, BIC) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  kable()
```

---
# F-Test on life expectancy

---

class: center, middle
# Remedial measures
```{r warning=FALSE}
hist + qq  
```

---
class: center, middle
# Remedial measures
```{r message=FALSE}
labeled_outliars + labeled_qq
```

> A safe rule frequently suggested is to discard an outlier only if there is direct evidence that it represents an error in recording, a miscalculation, a malfunctioning of equipment, or a similar type of circumstance. -Chapter 3 p.108

---

# Remedial measures

```{r}
model_df5 %>% 
  broom::augment() %>% 
  mutate(yhat = predict(model_df5),
         resid = resid(model_df5)) %>% 
  ggplot() + 
  geom_point(aes(x = yhat, y = resid)) + 
  geom_hline(yintercept = 0, color = "red") + 
  scale_y_continuous(limits = c(-4,4))
```

---

# Brown - Forthe

* plot
* 
* vif
car::vif(fit)

* Brown Forsythe

---
# Conclusions

---
class: center, middle

# Thanks You and We are Happy to Take Questions

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

---

<font size="2">
```{r results='asis'}
stargazer::stargazer(fit_df6, model_df5, fit_df4, type = "html", 
                     title = "Regression Results", 
                     covariate.labels = c(),
                     header = FALSE,
                     single.row = TRUE)
```